4.2颗粒过滤器
4.2.1基本算法的微粒过滤器是一种替代非参数实现的贝叶斯过滤器。就像直方图过滤器，微粒过滤器通过参数有限数量逼近后路。但是，它们在产生这些参数的方式不同，并且其中它们填充状态空间。微粒过滤器的核心思想是代表后BEL（XT）由一组从这个后随机抽取样本的状态的。无花果URE？说明了这个想法高斯。而是代表由参数形式的分布（指数函数，定义了一个正常显示tribution的密度），颗粒过滤器代表分布了一套从这个分布抽取的样本中。这样的表示是近似的，但它是非参数，并there-前可以代表分布比的更广阔的空间，例如，高斯。
在颗粒物过滤器，一个后验分布的样品称为颗粒和被表示
XT：= X [1] T，X [2] T，。 。 。中，x [M] T（4.22），每个粒子×〔米] T（1≤米≤M）是状态的在时间t的具体实例，也就是，一个假设作为对真实世界状态可以是在什么时间t。 HereM表示

1：2：3：
4：5：6：
7：8：
9：
10：11：12：
粒子滤波（XT-1，UT，ZT）：
XT = XT =∅
¯
形式= 1汤姆做样本x [M]
牛逼〜P（XT | UT，X [M]
叔1）
W [M]
T = P（ZT | X [M]
T）
XT =¯¯
XT + X [M]
T，W [M] T ...？ ENDFOR形式= 1汤姆做
我画的概率αW [I]
Ť
加X [I]
吨至XT ENDFOR回到XT
表4.3的粒子滤波算法，基于重要性采样的贝叶斯滤波器的变型。

粒子在粒子数设置XT。在实践中，particlesM的数量通常是一个大数，例如，M = 1，000。在一些implementationsM是一个功能
的T或其他相关的信念BEL（XT）数量。
背后颗粒过滤器的直觉是近似的信念BEL（XT）由组粒子XT的。理想的情况下，也可以包括在颗粒系列XT应正比于它的贝叶斯过滤后贝尔（XT）的状态假设XT的可能性：
X [M]牛逼〜P（XT | Z1：T，U1：T）（4.23）
作为（4.23）的结果，该密集的状态空间的一个子区域填充通过样品时，更可能的是，在真实状态落入这个区域。正如我们将讨论
下面，物业（4.23）仅持有渐近对M↑∞为标准粒子滤波算法。对于有限男，颗粒从略微不同的分布中得到。在实践中，这种差异是可以忽略的，只要颗粒的数量不能太小（例如，男≥100）。
就像迄今为止讨论的所有其他贝叶斯滤波器的算法，粒子滤波器algo-
rithm构建信念BEL（XT）从递归的信念BEL（XT-1）早一个时间步长。因为信念是由集粒子表示，这意味着颗粒过滤器构造的粒子从集XT-1设置XT递归。粒子滤波器算法的最基本的变量是说在表4.3。该算法的输入是
粒子设置XT-1，随着最近的控制UT和最近的测量ZT。然后，该算法首先构造一个临时颗粒系列¯
x，它是
让人联想起（但不等同）的信念BEL（XT）。它通过系统地处理每个粒子X [M]做到这一点
叔1在输入颗粒系列XT-1如下。 1. 4行产生一个假想状态x [米] t表示基于粒子×〔米]叔1和控制UT时间t。所得样品为m索引，这表明它是
从XT-1的第m个粒子产生的。该步骤包括采样从下一状态分布p（XT | UT，XT-1）。为了实现这一步，人们需要能够从对样品（XT | UT，XT-1）。从状态转移概率抽样的能力不是任意的分布给出：P（XT | UT，XT-1）。然而，在这本书中许多主要分布具有有效的算法
发电样本。这组由迭代步骤4M时代产生的粒子是贝尔（XT）滤波器的代表。
2，5号线计算每个粒子X [M]
吨所谓重要性因子，记
W [M]
Ť
。重要性因子用于掺入测量ZT进
颗粒系列。的重要性，因此，是测量ZT的下的粒子×〔米]的概率
Ť
即，瓦特[米]
T = P（ZT | X [M] T）。如果我们的解释是W [M] T作为权重
一个粒子，该组加权粒子的代表（在近似）的贝叶斯过滤器后BEL（XT）。
3.粒子滤波算法真正的“猫腻”发生在第8行至11或表格4.3。这些线路实施所谓的重采样或重的重要性抽样。该算法绘制与replacementM颗粒从临时集合¯
XT。绘制每个粒子的概率是由它的重要性重量给出。重采样转换粒子设置OFM粒子到另一个粒子集
相同的大小。通过将重要性权进入再采​​样过程中，颗粒的分布变化：而重采样步骤之前，他们根据贝尔（XT）是分布，分布它们再采样后（约）根据后贝尔（XT） η= P（ZT | X [M]
T）BEL（XT）。在
事实上，所得的样本集通常具有许多重复的，因为颗粒被吸引与更换。更重要的是没有被CON-在XT tained颗粒：那些倾向于具有较低重要性的权重的粒子。
重采样步骤具有强制颗粒回后的重要作用
BEL（XT）。实际上，另一种（通常劣）版本的微粒过滤器将永远不会重新取样，而是将维持每个粒子的重要性权重
该初始化为1和乘法更新：W [米]
T = P（ZT | X [M] t）的W [M] T-1（4.24）
这样的粒子滤波算法仍接近后，但它的许多颗粒将结束低后验概率的区域。其结果是，它需要更多的颗粒;多少取决于后部的形状。重采样步骤是概率实现优胜劣汰的达尔文想法：重新调整它的颗粒设置为区域高后验概率状态空间。通过这样做，它着重滤波器算法的计算资源，以区域的状态空间，他们最重要。
4.2.2重要抽样
用于微粒过滤器的推导，应当证明是有用的，以更详细地讨论的重采样步骤。图4.2显示了采样落后一步的直觉。图4.2A示出了被称为目标分配概率分布的密度函数f。我们想实现的是获得来自F A样本。然而，从步骤f直接取样可能是不可能的。相反，我们可以生成从相关密度的颗粒，在图4.2B标记克对应于密度克分布称为建议分布。的密度为必须使得函数f（x）> 0意味着克（x）的> 0，使得存在一个非零概率从g下可能通过从步骤f采样产生的任何状态进行采样时产生的颗粒。然而，所得到的粒子集，在图4.2B的底部示出，是根据分布式
到克，不F。特别是，对于任何一个区间范围⊆（X）（或更一般地，任何博雷尔集A）颗粒的经验计数落入一个收敛于克下的积分：
M 1
？
M I（X [M]∈A） - →
m = 1时
？克（x）的DX A（4.25）为了抵消f和g，粒子x之间的这种差异[米]是由商加权
W [M] = F（X [M]）G（X [M]）
（4.26）​​98
这被示出由图4.2C：在该图中的竖线表示的重要性权重的大小。重要性权重是每个粒子的非归一化概率质量。特别是，我们有
？ M
？-1 M
？
W [M]
？
I（X [M]∈A）W [M] - →M = 1，M = 1？ F（X）DX A（4.27）
其中第一项作为正规化器用于所有重要性的权重。换言之，尽管我们产生由密度克颗粒中，适当加权粒子收敛到密度F。
具体涉及融合集成了一组A.显然，一个粒子组代表一个离散分布，而f是在我们的例子是连续的。由于这个原因，就没有可能与一组颗粒的相关联密度。 CON组收敛，因此，是在f的累积分布函数，而不是密度本身（因此积分超过A）中。重要抽样的一个很好的特性是它CON组青草的真密度如果g（x）> 0时函数f（x）> 0。在大多数情况下，率
收敛是在O（1√M），其中M是样品的数目。恒定系数取决于F（多个）和g（多个）的相似性。
在微粒过滤器中，密度˚F对应于目标信念贝尔（XT）。下（渐近正确的）的假设，即颗粒inXt-1根据贝尔分布（XT-1）中，密度为对应于产品分布：
P（XT | UT，XT-1）BEL（XT-1）分布称为建议分布。 PF的的（4.28）4.2.3数学推导
为了获得数学颗粒物过滤器，它应证明是有益的思考颗粒作为状态序列x的样本[M]。
0：T = X [M] 0，X [M] 1。 。 。 ，X [M] T（4.29）
这是很容易相应地修改该算法：只需追加到粒子X [米]
Ť
从它被生成状态样本序列x [米]
0：叔 - 1。这种微粒过滤器
计算后在所有的状态序列：贝尔（X0：T）= P（X0：T | U1：T，Z1：T）
（4.30）
而不是信仰BEL（XT）= P（XT | U1：T，Z1：T）。诚然，在所有状态序列的空间是巨大的，并且与颗粒覆盖它通常是显然不可行。怎么样-
以往，这不应阻止我们在这里，因为这个定义只作为手段来推导粒子滤波算法表4.2。
后BEL（X0：T）是类似于实施的BEL（XT）在见第2.4.3推导。特别是，我们有
P（X0：T | Z1：T，U1：T）=贝叶斯ηP（ZT | X0：T，Z1：T-1，U1：T）P（X0：T | Z1：T-1，U1：T ）马尔可夫=ηP（ZT | XT）P（X0：吨| Z1：叔1中，U1：t）的
=ηP（ZT | XT）ρ（XT | X0：T-1，Z1：叔1中，U1：t）的P（X0：叔1 | Z1：叔1中，U1：t）的马氏=ηp （ZT | XT）ρ（XT | XT-1，UT）P（X0：叔1 | Z1：叔1中，U1：T-1）
（4.31）
通知的情况下积分迹象在这个推导，这是可维护性荷兰国际集团中的所有状态后，不只是最近的一个作为在2.4.3节中的结果。
推导现在通过感应进行。初始条件是微不足道的验证，
假设被采样之前P（X0）获得我们的第一个粒子集。让我们假定粒子设定在时刻t-1，根据贝尔分布（X0：T-1）。对于第m个粒子X [米]
0：T-1在这组中，样本x [M] T在我们的算法的步骤4中产生从建议分布产生：
ρ（XT | XT-1，UT）贝尔（X0：T-1）=ρ（XT | XT-1，UT）P（X0：叔1 | Z0：T-1，U0：T-1）
与W [M] T =目标分配方案分配
=ηP（ZT | XT）ρ（XT | XT-1，UT）P（X0：叔1 | Z1：叔1中，U1：T-1）ρ（XT | XT-1，UT）ρ（ X0：叔 - 1 | Z0：T-1，U0：T-1）
η= P（ZT | XT）（4.32）（4.33）
恒η起到任何作用，因为采样发生概率与正比于重要砝码。通过与重采样概率成比例的颗粒
佐丹奴国W [M]
中，所得的颗粒被根据产品确实分布式
该提案的t和重要性权重w [M]
：
吨η瓦特[米] TP（XT | XT-1，UT）P（X0：叔1 | Z0：T-1，U0：T-1）=贝尔（X0：吨）（4.34）
（请注意，常数系数η这里不同于所述一个中（4.33）。）在表4.2的算法如下现在从简单的观察，如果x [米]
0：t为根据分布
到贝尔（X0：吨），则状态样本x [米]
t为（平凡）据贝尔（XT）分布。
正如我们下面讨论的，这个推导是唯一正确的形式 - →∞，由于我们考虑的规范化常数的腹泻。然而，即使是有限的M感受
解释了微粒过滤器背后的直觉。
颗粒过滤器的性能4.2.4
微粒过滤器是近似的，因此受到逼近误差。有近似误差四个免费源，其中每一个产生该微粒过滤器的改进版本。
1.第一逼近误差涉及只有有限的粒子的使用的事实。这神器介绍于后估计值的系统性偏差。看，考虑M = 1颗粒的极端情况。在这种情况下，在表4.3的环中3行至第7将只被执行一次，并¯
XT将包含
只有单个颗粒，从运动模型采样。关键的观点是，在重采样步骤（表4.3行8〜11）现在将确定性
接受这个样本，无论其重要性系数W [M]
。换句话说，经t
测量概率p（ZT | X [米]
T）起着更新的结果没有任何作用，
而且也不ZT。因此，如果M = 1，粒子滤波器从概率生成颗粒
P（XT | U1：T）（4.35）
的，而不是所期望的后验概率P（XT |的u1：吨，Z1：t）的。它断然忽略所有测量。怎么能这样呢？
罪魁祸首就是正常化，隐含在重采样步骤。当按比例的重要性的权重（该算法的9行），瓦特[米]取样
T变为
自己的归IFM = 1：P（抓X [M]
在9号线）= W [M] T ...
T水[M] = 1 T（4.36）
在一般情况下，问题是，非归一化的值（重量）[米]是从ANM维空间绘制的，但归一化之后它们驻留在的维数的空间
sionM-1。这是因为归一化之后，将其第重量可以从他们-1减去那些从1幸运的是，对于较大的数值OFM回收其他的权重，维，或自由度的损耗的效果，变得越来越少明显。
2.错误的微粒过滤器的第二个来源涉及随机性介绍 - duced在重采样阶段。要理解这个错误，它会再次成为考虑极端情况下，它是一个机器人，其状态不有用
改变。有时候，我们知道一个事实，即XT = XT-1。一个很好的例子是，移动机器人定位，对于一个非移动机器人。让我们进一步假定机器人具有无传感器，因此它无法估计的状态，那
这是不知道的状态。最初，我们的粒子组X0将会从先前产生的;因此，粒子将在整个状态空间进行传播。重采样步骤（8号线的算法）的随机特性将定期无法得出一个状态样本x [M]。但是，由于我们的状态转移是确定的，没有新的国家将在向前采样步骤（4号线）出台。其结果是相当艰巨：以概率1，单一状态M相同的副本将生存;的多样性会消失由于反复重采样。到外部服务器转播，它可能会出现的机器人唯一确定的世态，一个明显的矛盾，以机器人具有无传感器的事实。
这个例子暗示与巨大实际后果颗粒过滤器的重要限制。特别是，再采样处理诱导二多样性的在颗粒种群，这实际上本身表现为近似误差的损失。这种误差被称为估计的方差：即使该颗粒的方差设定本身的减小，粒子设定为真正的信念增加一个估计的方差。控制该方差，或错误时，粒子滤波器为任何实际实施是必不可少的。
存在方差减少的两大战略。第一，可以减少在该重新采样发生的频率。当该状态被称为是静态的
（XT = XT-1）一个人永远不能重新取样。是这种情况下，例如，在移动机器人定位：当机器人停止，重新采样应暂停（事实上，通常暂停测量的集成，以及一个好主意）。即使状态的变化，它往往是减少重采样的频率是个好主意。多次测量总是可通过倍增集成
1：2：3：
4：5：6：7：8：9：
10：11：
12：13：14：
算法低方差采样器（XT，WT）：
XT =∅
¯
R =兰特（0，M-1）C = W [1]
T I = 1的形式= 1汤姆做
U = R +（M-1）·M-1，而U>Ç
I = I + 1 C = C + W [I] T ...
ENDWHILE加X [I]
吨至¯XT ENDFOR回报¯XT
表4.4低方差为重采样粒子滤波。此例程使用单一随机数到从颗粒setX的关联weightsW样，但粒子进行重新采样的probabil-性仍正比于其重量。此外，采样是有效的：SamplingM颗粒需要O（M）的时间。
如上所述更新的重要性因子。更具体地，它保持了重要性重量在存储器和更新它们如下：
W [M] T =？ 1，如果采样发生P（ZT | X [M] t）的W [M] T-1，如果没有重采样发生（4.37）
当重新取样的选择是复杂的，需要实践经验：重新取样过于频繁会增加多样性丧失的风险。如果有太多的样本很少，许多样品可能在低概率的区域被浪费。一个标准的方法来确定采样是否应进行是测量的重要性权重的变化。权重的方差涉及的样品的代表性的效率。如果所有的权重是相同的，那么方差为零，没有重新采样应该执行。如果，在另一方面，在权重集中于少数的样本，则重量方差是高和重新采样应该执行。
用于减少抽样误差的第二策略被称为低方差采样。表4.4示出了低方差采样的实现。其基本思路是，而不是选择样本彼此独立地在再采样处理（如对表4.3的基本颗粒过滤器的情况下）即，该选择涉及一个顺序随机过程。
相反choosingM随机数，并选择那些任意一台spond这些随机数字粒子，这种算法计算一个随机数，选择样本，根据这个数字，但仍与该试样重量的概率成正比。这是由在区间[0绘制一个随机数r实现; M-1 [，whereM是在时间t要绘制的样本数。表4.4的算法然后通过反复加入固定amountM-1至r和通过选择对应于所得数目的粒子选择的颗粒。任何数u在[0; 1]指向只有一个粒子，即粒子对我这
Ĵ
I = argmin
？
W [M]牛逼≥ü
Ĵ
m = 1时
（4.38）
表4.4 while循环有两个任务，它计算在这个方程的右手侧的总和，另外检查是否i是第一粒子，使得权重的相应总和超过u的索引。选择，然后进行在12行这个过程也示于图4.3。
低方差采样器的优点是三倍。首先，它涵盖的样本空间较独立的随机取样更系统的方式。这应该是显而易见的，通过所有的粒子因采样周期的系统，而不是自主选择他们随意的事实。第二，如果所有的样品都具有相同的重要性的因素，所得到的样张设定¯
XT相当于XT所以，如果我们重新取样，而不没有样品被丢失
具有集成观察到XT。第三，在低方差取样有
一个复杂性为O（M）。实现独立SAM-相同的复杂
耦难度大;明显的实现需要O（logM）搜索一旦随机数已绘制每个粒子，这会导致O（MlogM）的复杂性，整个采样处理。计算时间的本质利用粒子过滤器时，往往一个高效的执行重采样过程中可以使在实用性能上的巨大差异。由于这些原因，在机器人粒子滤波器大多数实现往往依靠mech- anisms像一个刚才讨论。
在一般情况下，在有效采样文献是巨大的。另一种流行的选择是分层抽样，其中颗粒分为子集。在每个子集的样本数，可以保持而不管包含在每个子集中的颗粒的总重量相同的随时间。这些技术往往表现良好时，机器人跟踪多个不同的假设与一个颗粒过滤器。
错误3.第三个来源是关于该提案的分歧和目标显示tribution。我们已经暗示了上述问题，在讨论重要性采样时。从本质上说，从一个建议分布不考虑测量产生的颗粒（参​​见，等式（4.28））。当然，目标分配，这就是我们熟悉的贝叶斯过滤器后，依赖于测量。微粒过滤器的效率依赖于关键的建议和目标分布之间的“匹配”。如果，在一个极端，机器人的传感器是非常不准确的，但它的运动是非常准确的，目标分发将类似于建议分布和粒子过滤器将是有效的。如果，在另一方面，所述传感器是高度精确的，但运动不是，这些分布可以偏离基本上，将所得颗粒过滤器可以变得任意地低效。这方面的一个极端的例子是有确定性的传感器的机器人。对于最确定的传感器，测量的支持
概率p（Z | X）将被限制到状态空间的一个子流形。为前充裕，可以考虑移动机器人与噪声的范围进行定位
传感器。显然，P（Z | X）将是零，几乎每一个状态x，与匹配的范围内测量z中的完全相同的EX- ceptions。这样的情况
可能是致命的：建议分布几乎将永远不产生这正好对应于测量范围Z A样本x。因此，所有的重要性的权重将是零的概率是1，并再采样步骤变得虐待
空调。更一般地，如果p（Z | x）是简并的，这意味着它的支持被限制为比状态空间的维数较小尺寸的歧管，平粒子滤波算法是不适用的。
存在一系列的技术来克服这个问题。一个头脑简单的方法是简单地承担更多的噪音比感觉有气动执行
盟友。例如，一个人可能使用的测量模型P（Z | x），所overes- timates范围内测量的实际噪声。在许多实现中，这样的步骤改善了颗粒过滤器，尽管使用的是故意不正确的测量概率的奇特的准确性。其他技术涉及建议分布在了结合测量的方法的修改。这种技术将在本书后面的章节中讨论。
颗粒过滤器4的第四和最后的缺点是被称为粒子德穷困问题。当在高维空间中执行的估计，有可能在附近，以正确的状态没有颗粒。这可能是BE-导致颗粒的数量太小，覆盖所有相关区域具有高似然性。然而，人们可能会认为，这最终一定会发生在任何粒子过滤器，无论是颗粒系列sizeM的。粒子发生剥夺随机采样的结果;一个不幸的随机数序列能够消灭临近的真实状态的所有粒子。在每个重复采样步骤，对于这种情况发生的概​​率大于零（虽然它是通常呈指数小于M）。因此，我们只需要运行粒子滤波足够长的时间。最终，我们将产生一个估计是任意不正确。
在实践中，这种性质的问题只倾向于出现当M是相对于所有状态的具有高似然性的空间小。一种流行的解决这个问题出增加运动和的测量命令的实际序列的少量随机产生的颗粒进入设置每个二次采样处理后，无论。这种方法可以减少（但不固定）的粒子剥夺的问题，但在一个不正确的后验估计的费用。添加随机样本的优势在于它的简单性：软件MOD-必要ification添加随机样本在微粒过滤器是最小的。作为一个经验法则，将随机样本应被视为最后的措施重新排序，如果所有其他技术来解决一个问题，剥夺失败应该只适用。

这个讨论表明，样品的代表性的质量与样本的数目增加而增加。一个重要的问题，因此多少样本应被用于一个特定的估计问题。不幸的是，没有完美的回答这个问题，它常常被留给用户，以确定样品的所需数量。作为一个经验法则，样品的数量强烈地依赖于状态空间的二 - mensionality和由粒子滤波器近似的分布的不确定性。例如，均匀分布需要更多的样品比分布集中在状态空间的一个小区域。对样本量更详细的讨论会在机器人定位的情况下给予，当我们考虑自适应微粒过滤器（见？）。
4.3摘要
本节介绍了两种非参数贝叶斯过滤器，过滤器直方图和颗粒过滤器。非参数过滤器通过价值有限数量逼近后路。下对系统模型和后的形状温和的假设，都具有该逼近误差均匀地收敛到零作为用于表示后的值的数目趋于无穷的财产。
直方图过滤器分解状态空间分成有限多个凸重新gions。它表示各区域的由单一数值的累积后验概率。
存在于许多机器人分解技术。特别是，一个分解的granu- larity可以或可以不依赖于环境中的结构。当它，将所得的算法通常被称为“拓扑”。
分解技术可分为静态和动态。静态退役位置事先做了信仰的形状无关。动态分解依靠机器人的信念，具体分解状态空间时，往往试图按比例增加的空间分辨率的后验概率。动态分解往往给出更好的结果，但他们也更难以实施。
替代非参数技术被称为颗粒过滤器。微粒过滤装置将状态的随机抽样，从后得出代表后验。这样的样品被称为颗粒。微粒过滤器是非常容易实现的，而他们是最通用的这本书代表了所有贝叶斯过滤算法。
具体的战略存在，以减少微粒过滤器的错误。其中最流行的是技术来减少该起因于算法的随机性的估计的方差，和技术用于适配按照后的复杂性颗粒的数量。
在这句和前面的章节讨论的滤波算法奠定了基础贯穿本书的其余部分中讨论最概率机器人算法。这里介绍的材料，代表了当今许多最流行的算法和概率机器人表示。]]
